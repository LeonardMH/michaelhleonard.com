require 'rake'
require 'html-proofer'
task :default => :test

desc "Serve a local instance of the site (localhost:4000)"
task :serve do
    system("bundle exec jekyll serve")
end

desc "Build the _site files to prepare for deployment"
task :build do
    system("bundle exec jekyll build")
end

desc "Do it live!"
task :deploy => :build do
    # when deploying to server, compress the build files with gulp
    system("gulp")

    command = [
        "rsync",
        "-rvz -e",
        "'ssh -p 2222'",
        "--delete",
        "_site/",
        "micha310@michaelhleonard.com:/home/micha310/public_html/"
    ]

    system(command.join(" "))
end

desc "Clear out the build files"
task :clobber do
    rm_rf "_site"
end

desc "Make sure everything is working"
task :test => :build do
  options = {
      :assume_extension => true
  }

  HTMLProofer.check_directory("./_site", options).run
end
